<Window x:Class="ZenBIM.Views.ReorderingView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ZenBIM Reorder" 
        Height="800" Width="1100"
        WindowStartupLocation="CenterScreen" Topmost="True"
        ResizeMode="NoResize" WindowStyle="None"
        AllowsTransparency="True" Background="Transparent">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/ZenBIM;component/Resources/ZenStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <Style x:Key="BtnClose" TargetType="Button">
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="Transparent">
                                <TextBlock Text="✕" FontSize="16" Foreground="#999999"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="{StaticResource GlassBackground}" CornerRadius="20" Margin="10" MouseDown="Window_MouseDown">
        <Border.Effect>
            <DropShadowEffect BlurRadius="40" Color="Black" Opacity="0.2" ShadowDepth="10"/>
        </Border.Effect>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="380"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="#FFFFFF" CornerRadius="20,0,0,20" Padding="30">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Re" FontSize="26" FontWeight="Light" Foreground="{StaticResource TextDark}"/>
                            <TextBlock Text="order" FontSize="26" FontWeight="Bold" Foreground="{StaticResource TextDark}"/>
                        </StackPanel>
                        <TextBlock Text="ZenBIM Advanced Tool" FontSize="12" Foreground="{StaticResource ZenGradientDetails}" FontWeight="Bold" Margin="0,0,0,20"/>
                    </StackPanel>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,10,0">
                        <StackPanel>

                            <TextBlock Text="1. Element Selection" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextDark}" Margin="0,0,0,10"/>
                            <TextBlock Text="Category" FontSize="12" Foreground="{StaticResource TextGray}" Margin="0,0,0,5"/>
                            <ComboBox x:Name="CmbCategory" DisplayMemberPath="Name" SelectionChanged="CmbCategory_SelectionChanged"/>

                            <StackPanel x:Name="PanelRoomFilters" Visibility="Collapsed" Background="#F0FDF4" Margin="0,0,0,15">
                                <Border BorderBrush="{StaticResource ZenPrimary}" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <StackPanel>
                                        <TextBlock Text="Advanced Filter (Rooms)" FontSize="12" FontWeight="Bold" Foreground="{StaticResource ZenPrimary}" Margin="0,0,0,8"/>

                                        <TextBlock Text="Filter by Parameter:" FontSize="11" Foreground="{StaticResource TextGray}"/>
                                        <ComboBox x:Name="CmbRoomFilterParam" SelectionChanged="CmbRoomFilterParam_SelectionChanged" Margin="0,5,0,5"/>

                                        <TextBlock Text="Required Value:" FontSize="11" Foreground="{StaticResource TextGray}"/>
                                        <ComboBox x:Name="CmbRoomFilterValue" SelectionChanged="CmbRoomFilterValue_SelectionChanged" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <TextBlock Text="2. What to renumber?" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextDark}" Margin="0,15,0,10"/>
                            <TextBlock Text="Target Parameter" FontSize="12" Foreground="{StaticResource TextGray}" Margin="0,0,0,5"/>
                            <ComboBox x:Name="CmbTargetParam" DisplayMemberPath="Definition.Name" SelectionChanged="RecalculatePreview"/>

                            <TextBlock Text="3. Sorting Criteria" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextDark}" Margin="0,15,0,10"/>
                            <ComboBox x:Name="CmbSortMethod" SelectionChanged="RecalculatePreview">
                                <ComboBoxItem Content="X Coordinates, then Y" IsSelected="True"/>
                                <ComboBoxItem Content="Y Coordinates, then X"/>
                                <ComboBoxItem Content="By ID (Creation)"/>
                            </ComboBox>

                            <TextBlock Text="4. Format" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextDark}" Margin="0,15,0,10"/>

                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Prefix" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <Border Style="{StaticResource InputContainer}">
                                        <TextBox x:Name="TxtPrefix" TextChanged="RecalculatePreview" Margin="10,0"/>
                                    </Border>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Suffix" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <Border Style="{StaticResource InputContainer}">
                                        <TextBox x:Name="TxtSuffix" TextChanged="RecalculatePreview" Margin="10,0"/>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Start (e.g. 01)" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <Border Style="{StaticResource InputContainer}">
                                        <TextBox x:Name="TxtStart" Text="01" TextChanged="RecalculatePreview" Margin="10,0"/>
                                    </Border>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Step" FontSize="12" Foreground="{StaticResource TextGray}"/>
                                    <Border Style="{StaticResource InputContainer}">
                                        <TextBox x:Name="TxtStep" Text="1" TextChanged="RecalculatePreview" Margin="10,0"/>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>

                    <StackPanel Grid.Row="2" Margin="0,15,0,0">
                        <Button Content="APPLY (AUTO)" Click="OnApplyClick" Style="{StaticResource BtnPrimary}" Height="45" Margin="0,0,0,10" FontSize="14"/>
                        <Button Content="MANUAL RENUMBERING..." Click="OnManualModeClick" Style="{StaticResource BtnSecondary}" Height="40" FontSize="13" ToolTip="Select elements one by one in the model"/>
                        <TextBlock x:Name="TxtCount" Text="0 elements found" HorizontalAlignment="Center" Margin="0,10,0,0" Foreground="{StaticResource TextGray}" FontSize="12"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Column="1" Margin="30">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Margin="0,0,0,20">
                    <TextBlock Text="Preview" FontSize="18" FontWeight="SemiBold" Foreground="{StaticResource TextDark}"/>
                    <Button HorizontalAlignment="Right" VerticalAlignment="Top" Click="BtnClose_Click" Style="{StaticResource BtnClose}"/>
                </Grid>

                <Border Grid.Row="1" Background="White" CornerRadius="12" BorderBrush="{StaticResource BorderLight}" BorderThickness="1">
                    <DataGrid x:Name="GridPreview" AutoGenerateColumns="False" CanUserAddRows="False" 
                              HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                              Background="Transparent" BorderThickness="0" RowHeight="35">

                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Padding" Value="10"/>
                                <Setter Property="Foreground" Value="{StaticResource TextGray}"/>
                                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                <Setter Property="BorderBrush" Value="{StaticResource BorderLight}"/>
                            </Style>
                            <Style TargetType="DataGridCell">
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Padding" Value="10,0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="DataGridCell">
                                            <Border BorderThickness="0" Background="{TemplateBinding Background}">
                                                <ContentPresenter VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E8F5E9"/>
                                        <Setter Property="Foreground" Value="Black"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.Resources>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding ElementId}" Width="80"/>
                            <DataGridTextColumn Header="Current" Binding="{Binding CurrentValue}" Width="*"/>
                            <DataGridTemplateColumn Header="New Value" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding NewValue}" FontWeight="Bold" Foreground="{StaticResource ZenPrimary}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>